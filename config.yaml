# Chibi Discord Bot Configuration

# Discord settings
discord:
  sync_commands_on_startup: true

# LLM Configuration
llm:
  # Primary provider (Ollama - local)
  primary:
    provider: "ollama"
    base_url: "http://localhost:11434"
    model: "gpt-oss:120b-cloud"
    timeout: 60
    max_retries: 2

  # Fallback provider (OpenRouter - cloud)
  fallback:
    provider: "openrouter"
    base_url: "https://openrouter.ai/api/v1"
    model: "openai/gpt-oss-120b"
    timeout: 90
    max_retries: 1

  # Shared LLM settings
  max_tokens: 1024
  temperature: 0.7

# Chibi persona
persona:
  name: "Chibi"
  description: "Time-traveling AI tutor from 22nd century"

# Mastery calculation thresholds (hybrid: LLM quality + correct ratio)
mastery:
  min_attempts_for_mastery: 3
  quality_threshold: 3.5      # Out of 5
  correct_ratio_threshold: 0.7  # 70% correct

# Database settings
database:
  path: "data/chibi.db"

# LLM Quiz Challenge settings (students try to stump the AI)
llm_quiz:
  target_wins_per_module: 3  # Number of successful stumps required per module
  # Quiz model (the one students try to stump)
  quiz_model: "meta-llama/llama-3-8b-instruct"
  quiz_base_url: "https://openrouter.ai/api/v1"
  # Evaluator model (judges both answers)
  evaluator_model: "glm-4.6:cloud"
  evaluator_base_url: "http://localhost:11434"

# Similarity detection for LLM Quiz anti-cheat
similarity:
  enabled: true
  similarity_threshold: 0.85  # 0-1, questions above this are rejected
  top_k: 5  # Number of similar questions to retrieve
  # Primary: Ollama (local)
  embedding_model: "nomic-embed-text"
  ollama_base_url: "http://localhost:11434"
  # Fallback: OpenRouter (cloud) - used when Ollama is unavailable
  fallback_enabled: true
  fallback_model: "qwen/qwen3-embedding-8b"
  fallback_base_url: "https://openrouter.ai/api/v1"
  # Storage
  chromadb_path: "data/chromadb"

# Agent settings (LangGraph-based orchestration)
agent:
  enabled: true
  # Channel IDs where natural language routing is enabled
  # Leave empty to disable NL routing (only slash commands will work)
  nl_routing_channels: []
  # Minimum confidence threshold for intent classification (0-1)
  intent_confidence_threshold: 0.7
  # Maximum conversation history to retain per user/channel
  max_conversation_history: 20
